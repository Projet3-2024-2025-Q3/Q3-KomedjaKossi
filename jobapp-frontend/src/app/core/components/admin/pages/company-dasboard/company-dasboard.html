<!-- company-dasboard.html -->
<mat-sidenav-container class="dashboard-container">
  <!-- Sidebar -->
  <mat-sidenav mode="side" opened class="sidebar">
    <!-- Profile card -->
    <div class="profile-card">
      <div class="avatar">
        <span>{{ profileName ? profileName[0] : '?' }}</span>
      </div>
      <div class="profile-info">
        <h3 class="profile-name">{{ profileName }}</h3>
        <p class="profile-email">{{ profileEmail }}</p>
        <span class="profile-role">Role: {{ profileRole }}</span>
      </div>

      <button mat-stroked-button class="logout-btn" (click)="logout()">
        <mat-icon>logout</mat-icon>
        Logout
      </button>
    </div>

    <!-- Navigation -->
    <mat-nav-list class="nav-list">
      <a mat-list-item class="nav-item active" (click)="navigate('company')">
        <mat-icon matListItemIcon>work</mat-icon>
        <span matListItemTitle>Jobs Management</span>
      </a>

      <!-- Settings with sub-options -->
      <div>
        <a mat-list-item class="nav-item" (click)="toggleSettings()">
          <mat-icon matListItemIcon>settings</mat-icon>
          <span matListItemTitle>Settings</span>
          <mat-icon class="arrow-icon">{{ settingsOpen ? 'expand_less' : 'expand_more' }}</mat-icon>
        </a>

        <div class="sub-menu" *ngIf="settingsOpen">
          <a mat-list-item class="nav-sub-item" (click)="openChangePasswordDialog()">
            <mat-icon matListItemIcon>lock</mat-icon>
            <span matListItemTitle>Change Password</span>
          </a>
        </div>
      </div>
    </mat-nav-list>
  </mat-sidenav>

  <!-- Main content -->
  <mat-sidenav-content class="main-content">
    <!-- Page header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">Offers Management</h1>
        <p class="user-count">
          {{ (filteredOffers?.length ? filteredOffers.length : (offers?.length || 0)) }} offer(s)
        </p>
      </div>

      <button mat-raised-button class="create-btn" (click)="createOffer()">
        <mat-icon>add</mat-icon>
        Create Offer
      </button>
    </div>

    <!-- Filters -->
    <div class="filters-bar">
      <div class="filters-row">
        <!-- Search -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search by title or description</mat-label>
          <input
            matInput
            [(ngModel)]="searchText"
            (ngModelChange)="applyFilters()"
            placeholder="e.g. Frontend Developer"
          />
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <!-- Actions -->
        <div class="filter-actions">
          <button mat-raised-button class="apply-btn" (click)="applyFilters()">
            Apply
          </button>
          <button mat-stroked-button class="reset-btn" (click)="resetFilters()">
            Reset
          </button>
        </div>
      </div>

      <!-- Results count when filtered -->
      <div class="filter-feedback" *ngIf="isFiltered">
        <span>{{ filteredOffers?.length || 0 }} results</span>
      </div>
    </div>

    <!-- Offers grid -->
    <div class="cards-grid">
      <!-- Empty state -->
      <div class="empty-state" *ngIf="(filteredOffers?.length ? filteredOffers : offers)?.length === 0">
        <mat-icon>work_outline</mat-icon>
        <p>No offers found.</p>
      </div>

      <!-- Cards -->
      <mat-card class="offer-card"
                *ngFor="let offer of (filteredOffers?.length ? filteredOffers : offers)">
        <div class="offer-card__header">
          <div class="logo" *ngIf="offer.logoUrl; else logoFallback">
            <img [src]="offer.logoUrl" alt="Company logo" />
          </div>
          <ng-template #logoFallback>
            <div class="logo-fallback">
              <span>{{ profileName ? profileName[0] : 'C' }}</span>
            </div>
          </ng-template>

          <div class="offer-card__titles">
            <mat-card-title>{{ offer.title }}</mat-card-title>
            <mat-card-subtitle>
              Created {{ offer.createdAt | date:'mediumDate' }}
            </mat-card-subtitle>
          </div>
        </div>

        <mat-card-content class="offer-card__content">
          <p class="offer-desc">
            {{ offer.description }}
          </p>
          <a *ngIf="offer.websiteUrl"
             [href]="offer.websiteUrl"
             target="_blank"
             rel="noopener"
             mat-button>
            <mat-icon>public</mat-icon>
            Website
          </a>
        </mat-card-content>

        <mat-card-actions align="end" class="offer-card__actions">
          <button mat-button color="primary" (click)="editOffer(offer)">
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button mat-button color="warn" (click)="deleteOffer(offer)">
            <mat-icon>delete</mat-icon>
            Delete
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
