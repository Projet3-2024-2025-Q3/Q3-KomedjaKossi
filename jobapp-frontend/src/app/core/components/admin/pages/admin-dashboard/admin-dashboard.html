<mat-sidenav-container class="dashboard-container">
  <!-- Sidebar -->
  <mat-sidenav mode="side" opened class="sidebar">
    <!-- Profile card -->
    <div class="profile-card">
      <div class="avatar">
        <span>{{ profileName ? profileName[0] : '?' }}</span>
      </div>
      <div class="profile-info">
        <h3 class="profile-name">{{ profileName }}</h3>
        <p class="profile-email">{{ profileEmail }}</p>
        <span class="profile-role">Role: {{ profileRole }}</span>
      </div>
      <button mat-stroked-button class="logout-btn" (click)="logout()">
        <mat-icon>logout</mat-icon>
        Logout
      </button>
    </div>

    <!-- Navigation -->
    <mat-nav-list class="nav-list">
  <a mat-list-item class="nav-item active" (click)="navigate('admin')">
    <mat-icon matListItemIcon>people</mat-icon>
    <span matListItemTitle>Management</span>
  </a>

  <!-- Settings avec sous-options -->
  <div>
    <a mat-list-item class="nav-item" (click)="toggleSettings()">
      <mat-icon matListItemIcon>settings</mat-icon>
      <span matListItemTitle>Settings</span>
      <mat-icon class="arrow-icon">{{ settingsOpen ? 'expand_less' : 'expand_more' }}</mat-icon>
    </a>

    <div class="sub-menu" *ngIf="settingsOpen">
      <a mat-list-item class="nav-sub-item" (click)="openChangePasswordDialog()">
        <mat-icon matListItemIcon>lock</mat-icon>
        <span matListItemTitle>Change Password</span>
      </a>
      <!-- Si on veut plus tard d'autres sous-options -->
    </div>
  </div>
</mat-nav-list>

  </mat-sidenav>

  <!-- Main content -->
  <mat-sidenav-content class="main-content">
    <!-- Page header -->
    <div class="page-header page-header--center">
      <h1 class="page-title">User Management</h1>
    </div>

    <!-- Filters -->
    <div class="filters-bar">
      <div class="filters-row">
        <!-- Search -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search by name, username or email</mat-label>
          <input matInput [(ngModel)]="searchText" (ngModelChange)="applyFilters()">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <!-- Role filter -->
        <mat-form-field appearance="outline" class="role-field">
          <mat-label>Role</mat-label>
          <mat-select [(ngModel)]="selectedRoles" multiple (selectionChange)="applyFilters()">
            <mat-option value="company">Company</mat-option>
            <mat-option value="student">Student</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Actions -->
        <div class="filter-actions">
          <button mat-raised-button class="apply-btn" (click)="applyFilters()">
            Apply
          </button>
          <button mat-stroked-button class="reset-btn" (click)="resetFilters()">
            Reset
          </button>
        </div>
      </div>

      <!-- Results count -->
      <div class="filter-feedback" *ngIf="isFiltered">
        <span>{{ dataSource.filteredData.length }} results</span>
      </div>
    </div>

    <!-- Users table -->
    <div class="table-container">
      <div class="empty-state" *ngIf="dataSource.data.length === 0">
        <mat-icon>people_outline</mat-icon>
        <p>No users found.</p>
      </div>

      <table mat-table [dataSource]="dataSource" matSort class="users-table" *ngIf="dataSource.data.length > 0">
        <!-- Full name -->
        <ng-container matColumnDef="fullName">
          <th mat-header-cell *matHeaderCellDef>Full Name</th>
          <td mat-cell *matCellDef="let user">
            {{ user.firstName }} {{ user.lastName }}
          </td>
        </ng-container>

        <!-- Username -->
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef >Username</th>
          <td mat-cell *matCellDef="let user">{{ user.username }}</td>
        </ng-container>

        <!-- Email -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef >Email</th>
          <td mat-cell *matCellDef="let user">{{ user.email }}</td>
        </ng-container>

        <!-- Role -->
        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef >Role</th>
          <td mat-cell *matCellDef="let user">
            <span class="role-badge">{{ formatRole(user.role) }}</span>
          </td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let user">
            <button mat-icon-button (click)="openEditDialog(user)" aria-label="Edit">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button class="delete-btn" (click)="openDeleteDialog(user)" aria-label="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
